# üìä –û—Ç—á–µ—Ç –æ–± –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–∞—à–±–æ—Ä–¥–∞

## üéØ –¶–µ–ª—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π –≤ –¥–∞—à–±–æ—Ä–¥–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## üîç –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö ‚ö†Ô∏è
- **DAU –º–µ—Ç—Ä–∏–∫–∏** - –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ `get_dau_metrics` –∏ `dashboard_summary`
- **Retention –º–µ—Ç—Ä–∏–∫–∏** - –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ `get_retention_metrics` –∏ `dashboard_summary`
- **–í–æ—Ä–æ–Ω–∫–∞ –∫–∞—Ä—Ç—ã –¥–Ω—è** - –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ `get_card_funnel_metrics` –∏ `dashboard_summary`
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ä—Ç—ã –¥–Ω—è** - –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ `get_scenario_stats` –∏ `dashboard_summary`
- **Value –º–µ—Ç—Ä–∏–∫–∏** - –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –≤ `get_value_metrics` –∏ `dashboard_summary`

### 2. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∑–æ–≤–æ–≤ ‚ö†Ô∏è
–í `main.py` –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞–ª–∏—Å—å:
- ‚úÖ –ß–µ—Ä–µ–∑ `get_admin_dashboard_summary` (–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
- ‚ùå –û—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `get_dau_metrics`, `get_retention_metrics`, –∏ —Ç.–¥. (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)

## üõ†Ô∏è –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### 1. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `show_admin_dashboard`
```diff
- # –ü–æ–ª—É—á–∞–µ–º DAU –∏ Retention –º–µ—Ç—Ä–∏–∫–∏
- dau_metrics = db.get_dau_metrics(days)
- retention_metrics = db.get_retention_metrics(days)

+ # –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ summary (—É—Å—Ç—Ä–∞–Ω—è–µ–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
+ dau_metrics = summary['dau']
+ retention_metrics = summary['retention']
```

### 2. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `show_admin_retention`
```diff
- retention = db.get_retention_metrics(7)
- dau = db.get_dau_metrics(7)

+ # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
+ summary = db.get_admin_dashboard_summary(7)
+ retention = summary['retention']
+ dau = summary['dau']
```

### 3. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `show_admin_funnel`
```diff
- funnel = db.get_card_funnel_metrics(days)

+ # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
+ summary = db.get_admin_dashboard_summary(days)
+ funnel = summary['funnel']
```

### 4. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `show_admin_value`
```diff
- # –î–ª—è –∞–¥–º–∏–Ω–∫–∏ –≤–∫–ª—é—á–∞–µ–º –∏—Å–∫–ª—é—á–∞–µ–º—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- value = db.get_value_metrics(days, include_excluded_users=True)

+ # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
+ summary = db.get_admin_dashboard_summary(days)
+ value = summary['value']
```

### 5. –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è `make_scenario_stats_handler`
```diff
- # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º
- card_stats = db.get_scenario_stats('card_of_day', days)
- reflection_stats = db.get_scenario_stats('evening_reflection', days)

+ # –ü–æ–ª—É—á–∞–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
+ summary = db.get_admin_dashboard_summary(days)
+ card_stats = summary['card_stats']
+ reflection_stats = summary['evening_stats']
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –ö–æ–ª–∏—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏
- **–°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤**: —Å 6 –¥–æ 1 (83.3% —Å–æ–∫—Ä–∞—â–µ–Ω–∏–µ)
- **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**: 100% –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö—Å—è –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–æ
- **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**: ‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- ‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –ø–æ–ª—É—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `dashboard_summary`
- ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**: –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î
- ‚úÖ **–£–ø—Ä–æ—â–µ–Ω–∏–µ –∫–æ–¥–∞**: –ú–µ–Ω—å—à–µ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞, –ø—Ä–æ—â–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥

## üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ dashboard_summary

```
dashboard_summary = {
    'retention': 6 –ø–æ–¥–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,      # D1, D7 retention
    'dau': 4 –ø–æ–¥–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,            # Today, Yesterday, 7d, 30d
    'card_stats': 8 –ø–æ–¥–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,     # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–∞—Ä—Ç—ã –¥–Ω—è
    'evening_stats': 8 –ø–æ–¥–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,  # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–µ—á–µ—Ä–Ω–µ–π —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏
    'funnel': 8 –ø–æ–¥–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,         # –í–æ—Ä–æ–Ω–∫–∞ –∫–∞—Ä—Ç—ã –¥–Ω—è
    'value': 3 –ø–æ–¥–ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π,          # Value –º–µ—Ç—Ä–∏–∫–∏
    'period_days': 7                    # –ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞
}
```

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –¥–∞–ª—å–Ω–µ–π—à–µ–º—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

### ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```python
# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
summary = db.get_admin_dashboard_summary(days)
dau = summary['dau']
retention = summary['retention']
funnel = summary['funnel']
```

### ‚ùå –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ (–¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ)
```python
# –û—Ç–¥–µ–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã - —Å–æ–∑–¥–∞—é—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
dau = db.get_dau_metrics(days)
retention = db.get_retention_metrics(days)
funnel = db.get_card_funnel_metrics(days)
```

## üîÆ –î–∞–ª—å–Ω–µ–π—à–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è —á–∞—Å—Ç–æ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö
@lru_cache(maxsize=1)
def get_cached_dashboard_summary(days: int = 7):
    return db.get_admin_dashboard_summary(days)
```

### 2. –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
```python
# –î–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ –¥–∞–Ω–Ω—ã—Ö –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
async def get_dashboard_summary_async(days: int = 7):
    return await db.get_admin_dashboard_summary_async(days)
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
```python
# –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
import time
start_time = time.time()
summary = db.get_admin_dashboard_summary(days)
execution_time = time.time() - start_time
logger.info(f"Dashboard summary loaded in {execution_time:.3f}s")
```

## ‚úÖ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!**

- üéØ **–¶–µ–ª—å –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–∞**: –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–π
- üìä **–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**: –°–æ–∫—Ä–∞—â–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ 83.3%
- üîß **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**: –£–ø—Ä–æ—â–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —É–ª—É—á—à–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞
- ‚úÖ **–ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–º–∏

**–î–∞—à–±–æ—Ä–¥ —Ç–µ–ø–µ—Ä—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –∏ –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ 