# üìä –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

–°–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∞–Ω–∞–ª–∏–∑–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –±–æ—Ç–∞ "–†–µ—Å—É—Ä—Å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫".

## üéØ –¶–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã

- **–ò–∑–º–µ—Ä–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è** –∫–∞–∂–¥–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è (DAU –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º)
- **–ê–Ω–∞–ª–∏–∑ –≥–ª—É–±–∏–Ω—ã –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è** (–¥–æ—à–µ–ª –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ –∫–æ–Ω—Ü–∞ –∏–ª–∏ –±—Ä–æ—Å–∏–ª)
- **–í—ã—è–≤–ª–µ–Ω–∏–µ —É–∑–∫–∏—Ö –º–µ—Å—Ç** –≤ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
- **–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —à–∞–≥–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ UX

## üéØ –ù–æ–≤—ã–µ –¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è "–ö–∞—Ä—Ç–∞ –¥–Ω—è"

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç 5 –∫–ª—é—á–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –æ–ø—ã—Ç–∞:

### 1. üìù –¢–∏–ø –∑–∞–ø—Ä–æ—Å–∞ –∫ –∫–∞—Ä—Ç–µ
- **–¢–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ñ–æ—Ä–º—É–ª–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å –ø–∏—Å—å–º–µ–Ω–Ω–æ
- **–ú—ã—Å–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ—Ä–∂–∏—Ç –∑–∞–ø—Ä–æ—Å –≤ —É–º–µ

### 2. ü§ñ –í—ã–±–æ—Ä —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ —Å –ò–ò
- **–í—ã–±—Ä–∞–ª–∏** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–≥–ª–∞—Å–∏–ª—Å—è –Ω–∞ —É–≥–ª—É–±–ª–µ–Ω–Ω—É—é —Ä–µ—Ñ–ª–µ–∫—Å–∏—é
- **–û—Ç–∫–∞–∑–∞–ª–∏—Å—å** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–µ–¥–ø–æ—á–µ–ª –∑–∞–≤–µ—Ä—à–∏—Ç—å —Å–µ—Å—Å–∏—é

### 3. üí¨ –ì–ª—É–±–∏–Ω–∞ –ò–ò-–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤** –Ω–∞ –ò–ò-–≤–æ–ø—Ä–æ—Å—ã (1-–π, 2-–π, 3-–π)
- **–ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è** –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞ —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏

### 4. üòä –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è
- **–£–ª—É—á—à–∏–ª–æ—Å—å** - —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ —Å—Ç–∞–ª–æ –ª—É—á—à–µ –ø–æ—Å–ª–µ —Å–µ—Å—Å–∏–∏
- **–£—Ö—É–¥—à–∏–ª–æ—Å—å** - —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ —Å—Ç–∞–ª–æ —Ö—É–∂–µ
- **–û—Å—Ç–∞–ª–æ—Å—å —Ç–µ–º –∂–µ** - —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### 5. ‚≠ê –û—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏
- **–ü–æ–º–æ–≥–ª–æ** - —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –ø–æ–ª–µ–∑–Ω–æ–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π
- **–ë—ã–ª–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ** - —Å–µ—Å—Å–∏—è –±—ã–ª–∞ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π, –Ω–æ –Ω–µ –æ—á–µ–Ω—å –≥–ª—É–±–æ–∫–æ–π
- **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≥–ª—É–±–æ–∫–æ** - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—Ç–µ–ª –±—ã –±–æ–ª–µ–µ –≥–ª—É–±–æ–∫–æ–π —Ä–∞–±–æ—Ç—ã

## üóÉÔ∏è –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞ `scenario_logs`
–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è:
```sql
CREATE TABLE scenario_logs (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    scenario TEXT NOT NULL,
    step TEXT NOT NULL,
    metadata TEXT,  -- JSON —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    timestamp TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
```

### –¢–∞–±–ª–∏—Ü–∞ `user_scenarios`
–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Å—Ü–µ–Ω–∞—Ä–∏—è–º:
```sql
CREATE TABLE user_scenarios (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    scenario TEXT NOT NULL,
    started_at TEXT,
    completed_at TEXT,
    steps_count INTEGER DEFAULT 0,
    status TEXT DEFAULT 'in_progress',  -- 'in_progress', 'completed', 'abandoned'
    session_id TEXT,
    FOREIGN KEY (user_id) REFERENCES users(user_id) ON DELETE CASCADE
);
```

## üîß –ú–µ—Ç–æ–¥—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ `database/db.py`:

```python
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è
db.log_scenario_step(user_id, scenario, step, metadata=None)

# –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
session_id = db.start_user_scenario(user_id, scenario)

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
db.complete_user_scenario(user_id, scenario, session_id)

# –û—Ç–º–µ—Ç–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏—è –∫–∞–∫ –±—Ä–æ—à–µ–Ω–Ω–æ–≥–æ
db.abandon_user_scenario(user_id, scenario, session_id)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
stats = db.get_scenario_stats(scenario, days=7)

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —à–∞–≥–∞–º
steps = db.get_scenario_step_stats(scenario, days=7)

# –ò—Å—Ç–æ—Ä–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
history = db.get_user_scenario_history(user_id)
```

## üìà –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1. üé¥ "–ö–∞—Ä—Ç–∞ –¥–Ω—è" (`card_of_day`)

**–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
- `started` - –Ω–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
- `already_used_today` - –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- `initial_resource_selected` - –≤—ã–±—Ä–∞–Ω –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å
- `request_type_selected` - –≤—ã–±–æ—Ä —Ç–∏–ø–∞ –∑–∞–ø—Ä–æ—Å–∞ (–º—ã—Å–ª–µ–Ω–Ω—ã–π/—Ç–µ–∫—Å—Ç–æ–≤—ã–π)
- `text_request_provided` - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
- `card_drawn` - –≤—ã—Ç—è–Ω—É—Ç–∞ –∫–∞—Ä—Ç–∞
- `initial_response_provided` - –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞—á–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
- `ai_reflection_choice` - –≤—ã–±–æ—Ä —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ —Å –ò–ò
- `ai_response_1_provided` - –æ—Ç–≤–µ—Ç –Ω–∞ –ø–µ—Ä–≤—ã–π –ò–ò-–≤–æ–ø—Ä–æ—Å
- `ai_response_2_provided` - –æ—Ç–≤–µ—Ç –Ω–∞ –≤—Ç–æ—Ä–æ–π –ò–ò-–≤–æ–ø—Ä–æ—Å
- `ai_response_3_provided` - –æ—Ç–≤–µ—Ç –Ω–∞ —Ç—Ä–µ—Ç–∏–π –ò–ò-–≤–æ–ø—Ä–æ—Å
- `mood_change_recorded` - –∑–∞–ø–∏—Å–∞–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è
- `usefulness_rating` - –æ—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ —Å–µ—Å—Å–∏–∏
- `completed` - —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
- `card_number` - –Ω–æ–º–µ—Ä –∫–∞—Ä—Ç—ã
- `user_request` - –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `request_type` - —Ç–∏–ø –∑–∞–ø—Ä–æ—Å–∞ ('mental' –∏–ª–∏ 'typed')
- `request_length` - –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
- `choice` - –≤—ã–±–æ—Ä —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏ —Å –ò–ò ('yes' –∏–ª–∏ 'no')
- `response_length` - –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –ò–ò-–≤–æ–ø—Ä–æ—Å
- `initial_resource` - –Ω–∞—á–∞–ª—å–Ω—ã–π —Ä–µ—Å—É—Ä—Å
- `final_resource` - –∫–æ–Ω–µ—á–Ω—ã–π —Ä–µ—Å—É—Ä—Å
- `change_direction` - –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏—è ('better', 'worse', 'same')
- `rating` - –æ—Ü–µ–Ω–∫–∞ –ø–æ–ª–µ–∑–Ω–æ—Å—Ç–∏ ('helped', 'interesting', 'notdeep')

### 2. üåô "–í–µ—á–µ—Ä–Ω—è—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è" (`evening_reflection`)

**–ö–ª—é—á–µ–≤—ã–µ —à–∞–≥–∏:**
- `started` - –Ω–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
- `good_moments_provided` - –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ —Ö–æ—Ä–æ—à–∏—Ö –º–æ–º–µ–Ω—Ç–∞—Ö
- `gratitude_provided` - –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
- `hard_moments_provided` - –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å –æ –Ω–µ–ø—Ä–æ—Å—Ç—ã—Ö –º–æ–º–µ–Ω—Ç–∞—Ö
- `completed` - —Å—Ü–µ–Ω–∞—Ä–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω

**–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ:**
- `answer_length` - –¥–ª–∏–Ω–∞ –æ—Ç–≤–µ—Ç–∞
- `ai_summary_generated` - –±—ã–ª –ª–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω AI-–∏—Ç–æ–≥

## üõ†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –∫–æ–¥

### –ü—Ä–∏–º–µ—Ä –¥–ª—è —Å—Ü–µ–Ω–∞—Ä–∏—è "–ö–∞—Ä—Ç–∞ –¥–Ω—è":

```python
# –ù–∞—á–∞–ª–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
session_id = db.start_user_scenario(user_id, 'card_of_day')
db.log_scenario_step(user_id, 'card_of_day', 'started', {
    'session_id': session_id,
    'today': today.isoformat()
})

# –°–æ—Ö—Ä–∞–Ω—è–µ–º session_id –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏
await state.update_data(session_id=session_id)

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤
db.log_scenario_step(user_id, 'card_of_day', 'initial_resource_selected', {
    'resource': resource_choice_label,
    'session_id': session_id
})

# –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å—Ü–µ–Ω–∞—Ä–∏—è
db.complete_user_scenario(user_id, 'card_of_day', session_id)
db.log_scenario_step(user_id, 'card_of_day', 'completed', {
    'card_number': card_number,
    'session_id': session_id
})
```

## üìä –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

### `/scenario_stats [–¥–Ω–∏]`
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 7).

**–ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:**
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:

üé¥ –ö–∞—Ä—Ç–∞ –¥–Ω—è:
  ‚Ä¢ –ó–∞–ø—É—Å–∫–æ–≤: 45
  ‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–π: 38
  ‚Ä¢ –ë—Ä–æ—à–µ–Ω–æ: 7
  ‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 84.4%
  ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —à–∞–≥–æ–≤: 8.2

üé¥ –î–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ '–ö–∞—Ä—Ç–∞ –¥–Ω—è':
  üìù –ó–∞–ø—Ä–æ—Å—ã: 25 —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö, 20 –º—ã—Å–ª–µ–Ω–Ω—ã—Ö
  ü§ñ –ò–ò-—Ä–µ—Ñ–ª–µ–∫—Å–∏—è: 30 –≤—ã–±—Ä–∞–ª–∏, 15 –æ—Ç–∫–∞–∑–∞–ª–∏—Å—å
  üí¨ –ò–ò-–æ—Ç–≤–µ—Ç—ã: 30‚Üí25‚Üí20
  üòä –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ: +15 -5 =20
  ‚≠ê –û—Ü–µ–Ω–∫–∞: 20üëç 10ü§î 8üòï

üåô –í–µ—á–µ—Ä–Ω—è—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è:
  ‚Ä¢ –ó–∞–ø—É—Å–∫–æ–≤: 23
  ‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–π: 21
  ‚Ä¢ –ë—Ä–æ—à–µ–Ω–æ: 2
  ‚Ä¢ –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: 91.3%
  ‚Ä¢ –°—Ä–µ–¥–Ω–µ–µ —à–∞–≥–æ–≤: 4.1
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–∏—Å—Ç–µ–º—ã:

```bash
python test_scenario_logging.py
```

–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞—Å—Ç —Ç–µ—Å—Ç–æ–≤—É—é –ë–î –∏ –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤—Å–µ—Ö –º–µ—Ç–æ–¥–æ–≤.

## üìã –ü—Ä–∏–º–µ—Ä—ã SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

### –ß–∞—Å—Ç–æ—Ç–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 7 –¥–Ω–µ–π:
```sql
SELECT DATE(timestamp), COUNT(DISTINCT user_id)
FROM scenario_logs
WHERE scenario = 'card_of_day' AND step = 'started'
GROUP BY DATE(timestamp);
```

### –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤:
```sql
SELECT 
  (COUNT(CASE WHEN status = 'completed' THEN 1 END) * 100.0) / COUNT(*) AS completion_rate
FROM user_scenarios
WHERE scenario = 'card_of_day';
```

### –£–∑–∫–∏–µ –º–µ—Å—Ç–∞ (–Ω–∞ –∫–∞–∫–∏—Ö —à–∞–≥–∞—Ö –±—Ä–æ—Å–∞—é—Ç):
```sql
SELECT step, COUNT(*) AS step_count
FROM scenario_logs
WHERE scenario = 'card_of_day'
GROUP BY step
ORDER BY step_count DESC;
```

### –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Å—Ü–µ–Ω–∞—Ä–∏—è:
```sql
SELECT AVG(
  (julianday(completed_at) - julianday(started_at)) * 24 * 60
) as avg_minutes
FROM user_scenarios
WHERE scenario = 'card_of_day' AND status = 'completed';
```

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è:

1. –î–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ —Å—Ç–æ–ª–±—Ü—ã –≤ –º–µ—Ç–æ–¥ `create_tables()`
2. –î–æ–±–∞–≤—å—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –≤ –º–µ—Ç–æ–¥ `_run_migrations()`
3. –î–æ–±–∞–≤—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –≤ –º–µ—Ç–æ–¥ `create_indexes()`

## üìù –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

1. **–í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ session_id** –¥–ª—è —Å–≤—è–∑—ã–≤–∞–Ω–∏—è —à–∞–≥–æ–≤ –æ–¥–Ω–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è
2. **–õ–æ–≥–∏—Ä—É–π—Ç–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞
3. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –æ—à–∏–±–∫–∏** –ø—Ä–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–∏ (–Ω–µ –ø—Ä–µ—Ä—ã–≤–∞–π—Ç–µ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–ª–æ—É)
4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —à–∞–≥–æ–≤** –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∞–Ω–∞–ª–∏–∑–∞
5. **–†–µ–≥—É–ª—è—Ä–Ω–æ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ UX

## üöÄ –ü–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

- [ ] –î–∞—à–±–æ—Ä–¥ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π –º–µ—Ç—Ä–∏–∫
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –º–µ—Ç—Ä–∏–∫
- [ ] A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ä—Å–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏ 